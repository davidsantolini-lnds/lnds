<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Mission : H√©l√®ne ‚ú®</title>

  <style>
    :root{
      --bg0:#050505;
      --bg1:#0b0713;
      --pink:#ff6bd6;
      --rose:#ff9a9e;
      --pearl:#fecfef;
      --mint:#75f3c6;
      --ink:#0b0b10;
      --glass:rgba(255,255,255,.07);
      --glass2:rgba(255,255,255,.10);
      --stroke:rgba(255, 107, 214, .28);
      --shadow:0 30px 90px rgba(0,0,0,.55);
      --soft:0 0 60px rgba(255, 107, 214, .20);
    }

    *{box-sizing:border-box;}
    html,body{height:100%;}
    body{
      margin:0;
      height:900vh; /* beaucoup de scroll = ‚Äúfilm‚Äù */
      background:var(--bg0);
      color:#fff;
      font-family:-apple-system,BlinkMacSystemFont,"Helvetica Neue",Arial;
      overflow-x:hidden;
    }

    /* HUD */
    .hud{
      position:fixed;
      top:14px;
      left:14px;
      right:14px;
      z-index:50;
      display:flex;
      gap:12px;
      align-items:center;
      pointer-events:none;
    }
    .chip{
      pointer-events:none;
      display:flex;
      align-items:center;
      gap:10px;
      padding:10px 12px;
      border-radius:999px;
      background:rgba(0,0,0,.35);
      border:1px solid rgba(255,255,255,.09);
      backdrop-filter: blur(12px);
      box-shadow: 0 15px 50px rgba(0,0,0,.35);
      min-width: 180px;
    }
    .dot{
      width:10px;height:10px;border-radius:50%;
      background:var(--mint);
      box-shadow:0 0 12px var(--mint);
    }
    .hud strong{font-size:.92rem;}
    .hud span{font-size:.82rem;color:rgba(255,255,255,.65)}
    .bar{
      flex:1;
      height:10px;
      border-radius:999px;
      background:rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.08);
      overflow:hidden;
      pointer-events:none;
    }
    .bar > i{
      display:block;height:100%;
      width:0%;
      background:linear-gradient(90deg, var(--rose), var(--pink), var(--mint));
      box-shadow: var(--soft);
    }

    /* Viewport 3D */
    .viewport{
      position:fixed;
      inset:0;
      perspective:1100px;
      overflow:hidden;
      background:
        radial-gradient(circle at 50% 40%, #1a1025 0%, #000 65%),
        linear-gradient(180deg, #000, #06030c);
    }
    .camera{
      position:absolute;
      inset:0;
      transform-style:preserve-3d;
      will-change:transform;
    }
    .sceneBackdrop{
      position:absolute;
      inset:0;
      z-index:0;
      transition: background 700ms ease, filter 700ms ease;
      background: linear-gradient(180deg, #dcecff 0%, #8bb4dc 45%, #3f6587 100%);
    }
    .scene-start{
      background: linear-gradient(180deg, #eff6ff 0%, #b9d2ef 45%, #5d7ea1 100%);
    }
    .scene-mid{
      background: linear-gradient(180deg, #d8ebff 0%, #8eb2d4 38%, #456582 100%);
    }
    .scene-lower{
      background: linear-gradient(180deg, #c7e0f7 0%, #7ea6c9 35%, #2f587a 100%);
    }
    .scene-finish{
      background: linear-gradient(180deg, #a8d5ff 0%, #5ea0cf 40%, #18507e 100%);
    }
    .snow{
      position:absolute;
      inset:-20% 0 0;
      pointer-events:none;
      z-index:1;
      opacity:.48;
      transition:opacity 500ms ease;
      background-image: radial-gradient(circle, rgba(255,255,255,.92) 1px, transparent 1.8px);
      background-size: 26px 26px;
      animation: snowfall 7s linear infinite;
    }
    @keyframes snowfall{
      to{ transform: translateY(120px) translateX(-20px); }
    }
    .snow.soft{opacity:.2;}

    .slope{
      position:absolute;
      inset:0;
      z-index:1;
      pointer-events:none;
      display:grid;
      place-items:center;
    }
    .slope:before{
      content:"";
      width:min(58vw, 680px);
      height:100%;
      background:linear-gradient(180deg, rgba(255,255,255,.85), rgba(225,240,255,.70));
      clip-path:polygon(47% 0%, 53% 0%, 69% 100%, 31% 100%);
      box-shadow:inset 0 0 40px rgba(255,255,255,.35);
      opacity:.42;
    }

    /* Stars */
    .particles{
      position:absolute;
      inset:0;
      transform-style:preserve-3d;
      pointer-events:none;
      filter: drop-shadow(0 0 12px rgba(255,255,255,.12));
    }
    .particle{
      position:absolute;
      border-radius:50%;
      box-shadow:0 0 12px currentColor;
      opacity:.85;
    }
    .streak{
      position:absolute;
      width:140px;
      height:2px;
      transform-origin:left center;
      background:linear-gradient(90deg, rgba(255,255,255,0), rgba(255,255,255,.8), rgba(255,255,255,0));
      opacity:.0;
      pointer-events:none;
      filter: blur(.2px);
    }


    .gates{
      position:absolute;
      inset:0;
      z-index:2;
      pointer-events:none;
      transform-style:preserve-3d;
    }
    .gate3d{
      position:absolute;
      left:50%;
      width:360px;
      height:120px;
      transform-style:preserve-3d;
      transform:translateX(-50%);
    }
    .pole{
      position:absolute;
      width:8px;
      height:110px;
      border-radius:8px;
      top:0;
      box-shadow:0 0 20px rgba(0,0,0,.25);
    }
    .pole.left{left:16px;}
    .pole.right{right:16px;}
    .pole.red{background:#ff4f7c;}
    .pole.blue{background:#5ab3ff;}
    .gate-msg{
      position:absolute;
      left:50%;
      top:22px;
      transform:translateX(-50%);
      padding:8px 14px;
      border-radius:999px;
      font-size:.84rem;
      color:white;
      background:rgba(7,13,24,.72);
      border:1px solid rgba(255,255,255,.22);
      white-space:nowrap;
      backdrop-filter:blur(8px);
    }

    /* Layers */
    .layer{
      position:absolute;
      top:50%;
      left:50%;
      width:min(1100px, 92vw);
      transform-style:preserve-3d;
      transform: translate(-50%,-50%);
    }

    .panel{
      position:relative;
      background: linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.05));
      border:1px solid rgba(255,255,255,.12);
      border-radius:28px;
      padding:26px 24px;
      box-shadow: var(--shadow);
      backdrop-filter: blur(14px);
      overflow:hidden;
    }
    .panel:before{
      content:"";
      position:absolute;
      inset:-2px;
      background: radial-gradient(circle at 25% 20%, rgba(255,107,214,.25), transparent 45%),
                  radial-gradient(circle at 75% 70%, rgba(117,243,198,.20), transparent 46%),
                  radial-gradient(circle at 50% 110%, rgba(255,154,158,.18), transparent 55%);
      opacity:.9;
      z-index:0;
      pointer-events:none;
    }
    .panel > *{position:relative; z-index:1;}

    .kicker{
      display:inline-flex;
      align-items:center;
      gap:10px;
      padding:8px 12px;
      border-radius:999px;
      background: rgba(0,0,0,.25);
      border:1px solid rgba(255,255,255,.10);
      font-size:.85rem;
      color:rgba(255,255,255,.75);
      letter-spacing:.3px;
    }
    .kicker b{
      color:#fff;
      font-weight:800;
    }

    h1{
      margin:14px 0 6px;
      font-size: clamp(2.2rem, 4vw, 3.3rem);
      line-height:1.05;
      text-shadow:0 0 26px rgba(255,107,214,.22);
    }
    h2{
      margin:10px 0 0;
      font-size: clamp(1.35rem, 2.3vw, 2rem);
      color: var(--pearl);
      text-shadow:0 0 20px rgba(255,154,158,.22);
    }
    p{
      margin:12px 0 0;
      color: rgba(255,255,255,.78);
      font-size:1.05rem;
      line-height:1.55;
    }

    .scrollHint{
      display:flex;
      gap:10px;
      align-items:center;
      margin-top:16px;
      color:rgba(255,255,255,.70);
      font-size:.95rem;
    }
    .arrow{
      width:34px;height:34px;border-radius:12px;
      display:grid;place-items:center;
      background:rgba(255,255,255,.08);
      border:1px solid rgba(255,255,255,.10);
      animation:bob 1.8s infinite;
    }
    @keyframes bob{
      0%,20%,50%,80%,100%{transform:translateY(0);}
      40%{transform:translateY(8px);}
      60%{transform:translateY(4px);}
    }

    /* Cards */
    .grid{
      margin-top:18px;
      display:grid;
      grid-template-columns: 1.1fr .9fr;
      gap:14px;
    }
    @media (max-width: 900px){
      .grid{grid-template-columns:1fr;}
    }
    .card{
      background: rgba(0,0,0,.18);
      border:1px solid rgba(255,255,255,.10);
      border-radius:22px;
      padding:18px 16px;
      box-shadow: 0 20px 70px rgba(0,0,0,.35);
    }
    .card h3{
      margin:0;
      font-size:1.05rem;
      letter-spacing:.2px;
      display:flex;
      gap:10px;
      align-items:center;
    }
    .pill{
      padding:4px 10px;
      border-radius:999px;
      background:rgba(255,255,255,.08);
      border:1px solid rgba(255,255,255,.10);
      font-size:.78rem;
      color:rgba(255,255,255,.72);
    }
    .list{
      margin:10px 0 0;
      padding:0;
      list-style:none;
      display:grid;
      gap:10px;
    }
    .list li{
      display:flex;
      gap:10px;
      align-items:flex-start;
      color:rgba(255,255,255,.80);
      font-size:.98rem;
      line-height:1.35;
    }
    .tick{
      width:18px;height:18px;border-radius:6px;
      margin-top:2px;
      background:linear-gradient(135deg,var(--rose),var(--pink));
      box-shadow:0 0 18px rgba(255,107,214,.22);
      flex:0 0 auto;
    }

    /* Countdown / CTA */
    .countdown{
      margin-top:16px;
      display:flex;
      gap:14px;
      flex-wrap:wrap;
      justify-content:flex-start;
    }
    .timebox{
      background: rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.12);
      border-radius:20px;
      padding:16px 16px;
      min-width:120px;
      box-shadow: var(--soft);
      backdrop-filter: blur(12px);
    }
    .num{
      font-size:2.35rem;
      font-weight:900;
      background:linear-gradient(90deg, var(--rose), var(--pearl));
      -webkit-background-clip:text;
      -webkit-text-fill-color:transparent;
      display:block;
      line-height:1;
    }
    .lab{
      margin-top:6px;
      display:block;
      font-size:.8rem;
      letter-spacing:2px;
      text-transform:uppercase;
      color:rgba(255,255,255,.60);
    }

    .ctaRow{
      margin-top:16px;
      display:flex;
      gap:12px;
      flex-wrap:wrap;
      align-items:center;
    }
    .btn{
      cursor:pointer;
      border:none;
      padding:12px 16px;
      border-radius:16px;
      color:#fff;
      font-weight:800;
      letter-spacing:.2px;
      background:linear-gradient(90deg, var(--pink), var(--rose), var(--mint));
      box-shadow:0 25px 80px rgba(255,107,214,.20);
      border:1px solid rgba(255,255,255,.16);
      transform: translateZ(0);
      transition: transform .15s ease, filter .15s ease;
    }
    .btn:hover{transform: translateY(-1px); filter:brightness(1.06);}
    .btn.secondary{
      background: rgba(0,0,0,.20);
      border:1px solid rgba(255,255,255,.14);
      box-shadow:none;
      font-weight:700;
      color:rgba(255,255,255,.86);
    }
    .fine{
      color:rgba(255,255,255,.62);
      font-size:.88rem;
      line-height:1.45;
      margin-top:10px;
    }

    /* Portal */
    .portal{
      margin-top:14px;
      height:260px;
      border-radius:26px;
      border:1px solid rgba(255,255,255,.12);
      overflow:hidden;
      background:
        radial-gradient(circle at 60% 40%, rgba(255,107,214,.35), transparent 50%),
        radial-gradient(circle at 30% 70%, rgba(117,243,198,.25), transparent 52%),
        linear-gradient(135deg, rgba(255,154,158,.15), rgba(0,0,0,.25));
      position:relative;
      box-shadow: var(--shadow);
    }
    .portal:before{
      content:"";
      position:absolute;
      inset:-40%;
      background: conic-gradient(from 180deg, rgba(255,107,214,.0), rgba(255,107,214,.35), rgba(117,243,198,.25), rgba(255,154,158,.35), rgba(255,107,214,.0));
      filter: blur(20px);
      animation: spin 7s linear infinite;
      opacity:.9;
    }
    .portal:after{
      content:"";
      position:absolute;
      inset:16px;
      border-radius:22px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.25);
      backdrop-filter: blur(10px);
    }
    @keyframes spin{
      from{transform:rotate(0deg);}
      to{transform:rotate(360deg);}
    }
    .portal .txt{
      position:absolute;
      inset:0;
      display:grid;
      place-items:center;
      z-index:3;
      text-align:center;
      padding:24px;
    }
    .portal .txt b{
      font-size:1.35rem;
      display:block;
    }
    .portal .txt span{
      display:block;
      margin-top:8px;
      color:rgba(255,255,255,.70);
    }

    /* Confetti canvas */
    canvas#fx{
      position:fixed;
      inset:0;
      pointer-events:none;
      z-index:60;
    }

    /* Small helper text */
    .mono{
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
      font-size:.9rem;
      color:rgba(255,255,255,.68);
      margin-top:10px;
      opacity:.95;
    }


    .poem{
      margin-top:16px;
      font-size:1rem;
      color:rgba(255,255,255,.86);
      min-height:1.6em;
      letter-spacing:.2px;
      text-shadow:0 0 16px rgba(255,107,214,.18);
    }

    .journeyTrack{
      margin-top:16px;
      display:grid;
      gap:10px;
    }
    .journeyStop{
      position:relative;
      padding:14px 14px 14px 44px;
      border-radius:16px;
      border:1px solid rgba(255,255,255,.12);
      background:rgba(0,0,0,.22);
    }
    .journeyStop:before{
      content:"";
      position:absolute;
      left:16px;
      top:17px;
      width:14px;
      height:14px;
      border-radius:999px;
      background:linear-gradient(135deg,var(--mint),var(--rose));
      box-shadow:0 0 16px rgba(117,243,198,.4);
    }
    .journeyStop b{display:block; font-size:1rem;}
    .journeyStop span{color:rgba(255,255,255,.72); font-size:.92rem;}

    .postcardWall{
      margin-top:16px;
      display:grid;
      grid-template-columns:repeat(3,minmax(0,1fr));
      gap:12px;
    }
    .postcard{
      padding:12px;
      border-radius:16px;
      border:1px solid rgba(255,255,255,.14);
      background:linear-gradient(160deg, rgba(255,255,255,.12), rgba(255,255,255,.03));
      min-height:132px;
    }
    .postcard h4{margin:0;font-size:1rem;}
    .postcard p{margin-top:8px;font-size:.92rem;line-height:1.45;}
    @media (max-width:900px){
      .postcardWall{grid-template-columns:1fr;}
    }
  </style>
</head>

<body>
  <canvas id="fx"></canvas>

  <div class="hud">
    <div class="chip">
      <i class="dot"></i>
      <div>
        <strong id="hudTitle">Navigation : s√©quence 0/7</strong><br/>
        <span id="hudSub">Scrolle ‚Äî le plan se d√©voile.</span>
      </div>
    </div>
    <div class="bar"><i id="prog"></i></div>
    <div class="chip" style="min-width:220px;justify-content:space-between;">
      <div>
        <strong id="parisClock">Paris</strong><br/>
        <span id="parisTz">Europe/Paris</span>
      </div>
      <span class="pill" id="heartbeat">LIVE</span>
    </div>
  </div>

  <div class="viewport">
    <div class="sceneBackdrop scene-start" id="sceneBackdrop"></div>
    <div class="snow" id="snow"></div>
    <div class="slope"></div>
    <div class="gates" id="gates"></div>
    <div class="camera" id="camera">
      <div class="particles" id="particles"></div>
      <div class="streak" id="streak"></div>

      <!-- LAYER 0 -->
      <div class="layer" style="transform: translate(-50%,-50%) translateZ(0px);">
        <div class="panel">
          <span class="kicker"><b>SLALOM MODE</b> ¬∑ Chausse tes skis</span>
          <h1>Amour, d√©part au sommet.</h1>
          <h2>Chaque scroll = une porte de slalom √† passer.</h2>
          <p>
            Tu descends la piste, tu prends les virages rouges et bleus,
            et tout en bas t‚Äôattend la ligne d‚Äôarriv√©e avec le compteur final.
          </p>
          <div class="scrollHint">
            <div class="arrow">‚Üì</div>
            <div>A-Team sur les skis. On garde le flow jusqu‚Äôen bas.</div>
          </div>
          <p class="poem" id="poemLine">‚ú¶ Respire, vise la prochaine porte, et fonce avec Amour.</p>
          <div class="mono">Objectif lisible : arriv√©e + timer vers 01/03/2026 00:00 (Paris).</div>
        </div>
      </div>

      <!-- LAYER 1 -->
      <div class="layer" style="transform: translate(-50%,-50%) translateZ(-1300px);">
        <div class="panel">
          <span class="kicker"><b>PORTE #1</b> ¬∑ Rouge</span>
          <h1>Bien chauss√©e, bien lanc√©e.</h1>
          <p>Petit mot d‚Äôamour: ‚ÄúTu glisses avec gr√¢ce, Amour. Continue, t‚Äôes magnifique.‚Äù</p>
        </div>
      </div>

      <!-- LAYER 2 -->
      <div class="layer" style="transform: translate(-50%,-50%) translateZ(-2600px);">
        <div class="panel">
          <span class="kicker"><b>PORTE #2</b> ¬∑ Bleue</span>
          <h1>Virage propre, regard loin.</h1>
          <p>Motiv‚Äô A-Team: ‚ÄúNe freine pas ton √©clat. Une porte de plus, on est ensemble.‚Äù</p>
        </div>
      </div>

      <!-- LAYER 3 -->
      <div class="layer" style="transform: translate(-50%,-50%) translateZ(-3900px);">
        <div class="panel">
          <span class="kicker"><b>PORTE #3</b> ¬∑ Rouge</span>
          <h1>Tu tiens la ligne parfaite.</h1>
          <p>Petit mot d‚Äôamour: ‚ÄúTon sourire vaut toutes les m√©dailles, garde la cadence.‚Äù</p>
        </div>
      </div>

      <!-- LAYER 4 -->
      <div class="layer" style="transform: translate(-50%,-50%) translateZ(-5200px);">
        <div class="panel">
          <span class="kicker"><b>PORTE #4</b> ¬∑ Bleue</span>
          <h1>Derniers appuis avant la ligne.</h1>
          <p>Motiv‚Äô finale: ‚ÄúA-Team √† fond. Encore un encha√Ænement, et c‚Äôest gagn√©.‚Äù</p>
        </div>
      </div>

      <!-- LAYER 5 -->
      <div class="layer" style="transform: translate(-50%,-50%) translateZ(-6500px);">
        <div class="panel">
          <span class="kicker"><b>LIGNE D‚ÄôARRIV√âE</b> ¬∑ Samedi soir + minuit</span>
          <h1 id="title">üéø Arriv√©e valid√©e : compteur final</h1>
          <p>Premi√®re surprise : samedi 28/02 √† 20h. Puis cap vers minuit.</p>

          <div class="countdown" id="countdown">
            <div class="timebox"><span class="num" id="days">00</span><span class="lab">Jours</span></div>
            <div class="timebox"><span class="num" id="hours">00</span><span class="lab">Heures</span></div>
            <div class="timebox"><span class="num" id="minutes">00</span><span class="lab">Minutes</span></div>
            <div class="timebox"><span class="num" id="seconds">00</span><span class="lab">Secondes</span></div>
          </div>

          <div class="ctaRow">
            <button class="btn" id="acceptBtn">‚úÖ Je passe la ligne (A-Team)</button>
            <button class="btn secondary" id="icsBtn">üìÖ Ajouter samedi 20h √† l‚Äôagenda</button>
            <button class="btn secondary" id="copyBtn">üì® Copier le plan</button>
          </div>

          <div class="fine" id="fineText">Rappel: premi√®re surprise √† 20h samedi soir. Compteur principal vers 01/03/2026 00:00 (Paris).</div>
        </div>
      </div>

      <!-- LAYER 6 -->
      <div class="layer" style="transform: translate(-50%,-50%) translateZ(-7800px);">
        <div class="panel">
          <span class="kicker"><b>FINISH</b> ¬∑ 01/03/2026 √† 00:00</span>
          <h1>Tu as descendu toute la piste. üèÅ</h1>
          <p>Lisible, net, √©l√©gant: on comprend direct qu‚Äôon chausse les skis. Et on c√©l√®bre.</p>
        </div>
      </div>

    </div>
  </div>

<script>
/* =========================
   1) 3D CAMERA (bon sens)
========================= */
const camera = document.getElementById("camera");
const DEPTH = 7800; // profondeur max de la s√©quence (dernier layer z=-7800)
const sceneBackdrop = document.getElementById("sceneBackdrop");
const snow = document.getElementById("snow");
const gates = document.getElementById("gates");
let targetZ = 0, currentZ = 0;
let targetRot = 0, currentRot = 0;

let mouseX = 0, mouseY = 0;
window.addEventListener("mousemove", (e) => {
  mouseX = (e.clientX / innerWidth) * 2 - 1;
  mouseY = (e.clientY / innerHeight) * 2 - 1;
}, { passive:true });

window.addEventListener("scroll", () => {
  const maxScroll = document.body.scrollHeight - innerHeight;
  const frac = maxScroll > 0 ? (scrollY / maxScroll) : 0;

  // ‚Äúavance‚Äù dans le tunnel : cam√©ra en Z positif => rapproche les layers n√©gatifs
  targetZ = frac * DEPTH;
  targetRot = -frac * 8;
}, { passive:true });

function tickCam(){
  currentZ += (targetZ - currentZ) * 0.075;
  currentRot += (targetRot - currentRot) * 0.075;

  const tiltX = mouseY * 2.2;
  const tiltY = mouseX * 2.2;
  const frac = Math.max(0, Math.min(1, currentZ / DEPTH));
  const turn = Math.sin(frac * Math.PI * 5) * 9;
  const drift = Math.sin(frac * Math.PI * 7) * 120;

  camera.style.transform = `
    translateX(${drift}px)
    translateZ(${currentZ}px)
    rotateZ(${currentRot + turn * 0.25}deg)
    rotateX(${tiltX + 1.6}deg)
    rotateY(${tiltY + turn}deg)
  `;

  requestAnimationFrame(tickCam);
}
tickCam();

[
  { z: -1100, x: -160, color: "red", msg: "Amour, garde la ligne ‚ú®" },
  { z: -2300, x: 140, color: "blue", msg: "A-Team: focus et style" },
  { z: -3600, x: -120, color: "red", msg: "Tu brilles √† chaque virage" },
  { z: -4900, x: 170, color: "blue", msg: "Encore un effort, championne" },
  { z: -6200, x: -90, color: "red", msg: "Ligne d‚Äôarriv√©e droit devant" }
].forEach((g) => {
  const el = document.createElement("div");
  el.className = "gate3d";
  el.style.top = "50%";
  el.style.transform = `translateX(-50%) translateX(${g.x}px) translateY(-60px) translateZ(${g.z}px)`;
  el.innerHTML = `
    <span class="pole left ${g.color}"></span>
    <span class="pole right ${g.color}"></span>
    <span class="gate-msg">${g.msg}</span>
  `;
  gates.appendChild(el);
});

/* =========================
   2) HUD progress + ‚Äúchapters‚Äù
========================= */
const prog = document.getElementById("prog");
const hudTitle = document.getElementById("hudTitle");
const hudSub = document.getElementById("hudSub");

function updateHud(){
  const maxScroll = document.body.scrollHeight - innerHeight;
  const frac = maxScroll > 0 ? (scrollY / maxScroll) : 0;
  prog.style.width = (frac * 100).toFixed(1) + "%";

  // 7 s√©quences
  const chapter = Math.min(7, Math.max(0, Math.floor(frac * 7.2)));
  hudTitle.textContent = `Navigation : s√©quence ${chapter}/7`;
  const subs = [
    "D√©part slalom : chausse les skis.",
    "Porte rouge : amour + rythme.",
    "Porte bleue : appui et pr√©cision.",
    "Porte rouge : relance et confiance.",
    "Porte bleue : derni√®re section.",
    "Arriv√©e : samedi 20h puis minuit.",
    "Finish : 01/03 00:00."
  ];

  sceneBackdrop.className = "sceneBackdrop " + (
    frac < 0.25 ? "scene-start" :
    frac < 0.5 ? "scene-mid" :
    frac < 0.78 ? "scene-lower" :
    "scene-finish"
  );
  snow.classList.toggle("soft", frac > 0.72);
  hudSub.textContent = subs[chapter] || subs[0];

  requestAnimationFrame(updateHud);
}
updateHud();

/* =========================
   3) Paris clock (petit d√©tail ‚Äúpro‚Äù)
========================= */
const parisClock = document.getElementById("parisClock");
function updateParisTime(){
  const fmt = new Intl.DateTimeFormat("fr-FR", {
    timeZone: "Europe/Paris",
    weekday:"short", hour:"2-digit", minute:"2-digit"
  });
  parisClock.textContent = `Paris ¬∑ ${fmt.format(new Date())}`;
  setTimeout(updateParisTime, 5000);
}
updateParisTime();

const poemLines = [
  "‚ú¶ Respire, vise la prochaine porte, et fonce avec Amour.",
  "‚ú¶ Slalom 2026: propre, lisible, √©l√©gant.",
  "‚ú¶ A-Team sur la piste: rouge, bleue, rouge, bleue.",
  "‚ú¶ Samedi 20h premi√®re surprise, puis minuit en beaut√©."
];
const poemEl = document.getElementById("poemLine");
let poemIndex = 0;
setInterval(() => {
  poemIndex = (poemIndex + 1) % poemLines.length;
  poemEl.animate([{ opacity: 0.2, transform: "translateY(4px)" }, { opacity: 1, transform: "translateY(0)" }], { duration: 420, easing: "ease-out" });
  poemEl.textContent = poemLines[poemIndex];
}, 3200);

/* =========================
   4) Particles + streak
========================= */
const particles = document.getElementById("particles");
const streak = document.getElementById("streak");
const colors = ["#ffffff", "#ff9a9e", "#fecfef", "#75f3c6"];

for(let i=0;i<220;i++){
  const p = document.createElement("div");
  p.className = "particle";
  const s = Math.random()*3 + 1.8;
  p.style.width = s + "px";
  p.style.height = s + "px";
  p.style.left = (Math.random()*200 - 50) + "vw";
  p.style.top  = (Math.random()*200 - 50) + "vh";
  p.style.transform = `translateZ(${Math.random()*-7200 + 900}px)`;
  p.style.color = colors[(Math.random()*colors.length)|0];
  p.style.opacity = (Math.random()*0.55 + 0.25).toFixed(2);
  particles.appendChild(p);
}

// streak random (mini ‚Äú√©toile filante‚Äù)
function fireStreak(){
  streak.style.left = (Math.random()*110 - 10) + "vw";
  streak.style.top  = (Math.random()*80 + 10) + "vh";
  const ang = (Math.random()*60 - 30);
  streak.style.transform = `rotate(${ang}deg)`;
  streak.style.opacity = "0.0";

  // fade-in/out
  streak.animate([
    { opacity: 0, transform:`rotate(${ang}deg) translateX(0px)`},
    { opacity: .85, transform:`rotate(${ang}deg) translateX(220px)`},
    { opacity: 0, transform:`rotate(${ang}deg) translateX(360px)`},
  ], { duration: 900, easing:"cubic-bezier(.2,.7,.2,1)" });

  setTimeout(fireStreak, 1200 + Math.random()*2600);
}
fireStreak();

/* =========================
   5) Countdown FIX√â Europe/Paris (1 mars 2026 √† 00h00)
========================= */
function getZonedTimestamp({ year, monthIndex, day, hour=0, minute=0, second=0, timeZone }) {
  const utcGuess = Date.UTC(year, monthIndex, day, hour, minute, second);

  const dtf = new Intl.DateTimeFormat("en-US", {
    timeZone,
    hour12:false,
    year:"numeric", month:"2-digit", day:"2-digit",
    hour:"2-digit", minute:"2-digit", second:"2-digit"
  });

  function partsInZone(ms){
    const parts = dtf.formatToParts(new Date(ms));
    const get = (t) => +parts.find(p => p.type === t).value;
    return { y:get("year"), m:get("month"), d:get("day"), hh:get("hour"), mm:get("minute"), ss:get("second") };
  }

  let corrected = utcGuess;
  for(let i=0;i<2;i++){
    const p = partsInZone(corrected);
    const asIfUTC = Date.UTC(p.y, p.m-1, p.d, p.hh, p.mm, p.ss);
    const desired = Date.UTC(year, monthIndex, day, hour, minute, second);
    corrected -= (asIfUTC - desired);
  }
  return corrected;
}

const targetDate = getZonedTimestamp({
  year: 2026, monthIndex: 2, day: 1, hour:0, minute:0, second:0, timeZone:"Europe/Paris"
});

const pad2 = (n) => String(n).padStart(2,"0");

const timer = setInterval(()=>{
  const now = Date.now();
  const d = targetDate - now;

  if(d <= 0){
    clearInterval(timer);
    document.getElementById("title").textContent = "üèÅ Minuit atteint : Joyeux anniversaire";
    document.getElementById("countdown").innerHTML = `<p style="margin-top:14px;font-size:1.15rem;color:rgba(255,255,255,.85)">
      Minuit valid√©. Premi√®re surprise d√©j√† lanc√©e √† 20h samedi soir. ‚ù§Ô∏è
    </p>`;
    return;
  }

  const days = Math.floor(d / (1000*60*60*24));
  const hours = Math.floor((d % (1000*60*60*24)) / (1000*60*60));
  const minutes = Math.floor((d % (1000*60*60)) / (1000*60));
  const seconds = Math.floor((d % (1000*60)) / 1000);

  document.getElementById("days").textContent = pad2(days);
  document.getElementById("hours").textContent = pad2(hours);
  document.getElementById("minutes").textContent = pad2(minutes);
  document.getElementById("seconds").textContent = pad2(seconds);
}, 1000);

/* =========================
   6) ICS download + copy invite
========================= */
function toICSDateUTC(ms){
  const d = new Date(ms);
  const p = (n)=>String(n).padStart(2,"0");
  return d.getUTCFullYear() + p(d.getUTCMonth()+1) + p(d.getUTCDate()) + "T" +
         p(d.getUTCHours()) + p(d.getUTCMinutes()) + p(d.getUTCSeconds()) + "Z";
}

document.getElementById("icsBtn").addEventListener("click", () => {
  const dtStart = getZonedTimestamp({ year: 2026, monthIndex: 1, day: 28, hour:20, minute:0, second:0, timeZone:"Europe/Paris" });
  const dtEnd = dtStart + 2*60*60*1000;

  const uid = (crypto.randomUUID ? crypto.randomUUID() : (Date.now()+"@mission"));
  const ics =
`BEGIN:VCALENDAR
VERSION:2.0
CALSCALE:GREGORIAN
PRODID:-//Mission Helene//FR
BEGIN:VEVENT
UID:${uid}
DTSTAMP:${toICSDateUTC(Date.now())}
DTSTART:${toICSDateUTC(dtStart)}
DTEND:${toICSDateUTC(dtEnd)}
SUMMARY:üéø Premi√®re surprise - samedi 28 f√©vrier 20h
DESCRIPTION:D√©but de soir√©e anniversaire √† 20h (Paris). Le compteur principal va jusqu'au 01/03/2026 00:00.
END:VEVENT
END:VCALENDAR`;

  const blob = new Blob([ics], { type: "text/calendar;charset=utf-8" });
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url;
  a.download = "anniversaire-28-fevrier-20h.ics";
  a.click();
  URL.revokeObjectURL(url);
});

document.getElementById("copyBtn").addEventListener("click", async () => {
  const msg =
`H√©l√®ne ‚ù§Ô∏è

Samedi 28/02 √† 20h: premi√®re surprise.
Puis on file ensemble jusqu'√† 00h00 (Paris) pour le cap du 01/03/2026.
Mode slalom: rouges, bleues, ligne d'arriv√©e.

A-Team + Amour. Tu valides ? ‚ú®`;

  try{
    await navigator.clipboard.writeText(msg);
    pulseText("Invitation copi√©e ‚úÖ");
  }catch(e){
    pulseText("Copie bloqu√©e ‚Äî s√©lectionne et copie manuellement.");
    alert(msg);
  }
});

function pulseText(text){
  const el = document.getElementById("fineText");
  const old = el.textContent;
  el.textContent = text;
  el.animate([{opacity:.3},{opacity:1}],{duration:450,easing:"ease-out"});
  setTimeout(()=>{ el.textContent = old; }, 2200);
}

/* =========================
   7) ‚ÄúAccept‚Äù => confetti + micro-cin√©ma
========================= */
const fx = document.getElementById("fx");
const ctx = fx.getContext("2d");
let W=0,H=0;
function resize(){
  W = fx.width = innerWidth * devicePixelRatio;
  H = fx.height = innerHeight * devicePixelRatio;
  fx.style.width = innerWidth + "px";
  fx.style.height = innerHeight + "px";
  ctx.setTransform(devicePixelRatio,0,0,devicePixelRatio,0,0);
}
addEventListener("resize", resize);
resize();

let confetti = [];
function spawnConfetti(){
  const n = 220;
  confetti = [];
  for(let i=0;i<n;i++){
    confetti.push({
      x: innerWidth/2 + (Math.random()*120 - 60),
      y: innerHeight/2 + (Math.random()*60 - 30),
      vx: (Math.random()*2 - 1) * (4 + Math.random()*8),
      vy: (Math.random()*-1) * (8 + Math.random()*10),
      g: 0.22 + Math.random()*0.18,
      s: 4 + Math.random()*6,
      r: Math.random()*Math.PI,
      vr: (Math.random()*2 - 1) * 0.2,
      c: colors[(Math.random()*colors.length)|0],
      life: 180 + (Math.random()*80|0)
    });
  }
}

function drawConfetti(){
  ctx.clearRect(0,0,innerWidth,innerHeight);
  for(const p of confetti){
    p.life--;
    p.vy += p.g;
    p.x += p.vx;
    p.y += p.vy;
    p.r += p.vr;

    ctx.save();
    ctx.translate(p.x, p.y);
    ctx.rotate(p.r);
    ctx.globalAlpha = Math.max(0, Math.min(1, p.life/220));
    ctx.fillStyle = p.c;
    ctx.fillRect(-p.s/2, -p.s/2, p.s, p.s*0.7);
    ctx.restore();
  }
  confetti = confetti.filter(p => p.life > 0 && p.y < innerHeight + 80);
  if(confetti.length) requestAnimationFrame(drawConfetti);
  else ctx.clearRect(0,0,innerWidth,innerHeight);
}

document.getElementById("acceptBtn").addEventListener("click", () => {
  spawnConfetti();
  drawConfetti();

  // Petit twist : on "boost" le scroll vers la fin (effet "signature")
  window.scrollTo({ top: document.body.scrollHeight, behavior: "smooth" });

  // Un message qui fait ‚Äúnovateur‚Äù
  const hb = document.getElementById("heartbeat");
  hb.textContent = "ACCEPT√â";
  hb.style.background = "rgba(117,243,198,.15)";
  hb.style.borderColor = "rgba(117,243,198,.35)";

  pulseText("Ligne pass√©e. A-Team + Amour jusqu‚Äô√† minuit. ‚ú®");
});
</script>
</body>
</html>
